{"version":3,"sources":["webpack://gatsby-starter-default/./src/templates/preview.js"],"names":["locale","slug","data","useState","secretPage","setSecretPage","pageContext","setPageContext","useCookies","cookies","setCookie","location","useLocation","secret","URLSearchParams","search","get","site","siteMetadata","languages","locales","defaultLocale","strapiGlobal","metaData","metadata","metaTitle","strapiPreview","process","GATSBY_PREVIEW_SECRET","path","secure","sameSite","useEffect","fetchAPI","context","id","localizations","isPreview","localizedPaths","getLocalizedPaths","fetchData","seo","global","sections","contentSections","className"],"mappings":"qQAwGA,UApFoB,SAAC,GAA4B,IAA1BA,EAAyB,EAAzBA,OAAQC,EAAiB,EAAjBA,KAAMC,EAAW,EAAXA,KAAW,GACVC,cAAS,MAAtCC,EADuC,KAC3BC,EAD2B,QAERF,cAAS,MAAxCG,EAFuC,KAE1BC,EAF0B,QAGjBC,SAAtBC,EAHuC,KAG9BC,EAH8B,KAIxCC,GAAWC,mBAEXC,EADS,IAAIC,gBAAgBH,EAASI,QACtBC,IAAI,UANoB,EAc1Cd,EANFe,KACEC,aACEC,UAAaC,EAV2B,EAU3BA,QAASC,EAVkB,EAUlBA,cAG1BC,EACEpB,EADFoB,aAGIC,EAAWnB,GAAU,iBACtBA,EAAWoB,SADW,CAEzBC,UAAU,WAAYrB,EAAWoB,SAASC,YAsC5C,OAjCEhB,EAAQiB,gBAAkBC,GAAYC,uBACtCf,IAAWc,GAAYC,uBAEvBlB,EAAU,gBAAiBiB,GAAYC,sBAAuB,CAC5DC,KAAM,IACNC,OAAQH,aACRI,SAAU,YAIdC,gBAAU,YACO,mCAAG,2GACKC,OAAS,kBAAkBjC,EAAnB,SAAkCC,GAD/C,gBACTC,EADS,KAEhBG,EAAcH,GAERgC,EAAU,CACdjC,KAAMC,EAAKD,KACXkC,GAAIjC,EAAKiC,GACTnC,OAAQE,EAAKF,OACboC,cAAelC,EAAKkC,cACpBhB,UACAC,gBACAgB,WAAW,GAGPC,GAAiBC,uBAAkBL,GAEzC3B,EAAe,OAAD,UAAM2B,EAAN,CAAeI,oBAhBb,2CAAH,qDAmBfE,KACC,CAACvC,EAAMmB,EAASC,EAAerB,IAE7BM,GAAgBgB,EAIhBb,EAAQiB,cAWX,gCACE,gBAAC,IAAD,CAAKe,IAAKlB,EAAUvB,OAAQM,EAAYN,OAAQ0C,OAAQpB,IACxD,gBAAC,IAAD,CAAQhB,YAAaA,EAAaoC,OAAQpB,GACvClB,GACC,2BACE,gBAAC,IAAD,CAAUuC,SAAUvC,EAAWwC,qBAdrC,gBAAC,IAAD,CAAQtC,YAAaA,EAAaoC,OAAQpB,GACxC,uBAAKuB,UAAU,oBAAf,uDANG","file":"component---src-templates-preview-js-5b8ea9eed85da6feb430.js","sourcesContent":["/**\n * You can preview pages with URLs like this:\n * http://localhost:8000/preview/<slug>?secret=<preview-secret>\n * where <preview-secret> is the GATSBY_PREVIEW_SECRET variable defined in your .env config\n * and <slug> is the slug you entered in Strapi for your page\n */\n\nimport React, { useState, useEffect } from \"react\"\n\nimport { fetchAPI } from \"@/utils/api\"\nimport { getLocalizedPaths } from \"@/utils/localize\"\n\nimport Sections from \"@/components/sections\"\nimport Layout from \"@/components/layout\"\nimport SEO from \"@/components/seo\"\n\nimport { useLocation } from \"@reach/router\"\nimport { useCookies } from \"react-cookie\"\nimport { graphql } from \"gatsby\"\n\nconst PreviewPage = ({ locale, slug, data }) => {\n  const [secretPage, setSecretPage] = useState(null)\n  const [pageContext, setPageContext] = useState(null)\n  const [cookies, setCookie] = useCookies()\n  const location = useLocation()\n  const params = new URLSearchParams(location.search)\n  const secret = params.get(\"secret\")\n  const {\n    site: {\n      siteMetadata: {\n        languages: { locales, defaultLocale },\n      },\n    },\n    strapiGlobal,\n  } = data\n\n  const metaData = secretPage && {\n    ...secretPage.metadata,\n    metaTitle: `Preview ${secretPage.metadata.metaTitle}`,\n  }\n\n  // The user is correctly trying to access the preview page\n  if (\n    cookies.strapiPreview !== process.env.GATSBY_PREVIEW_SECRET &&\n    secret === process.env.GATSBY_PREVIEW_SECRET\n  ) {\n    setCookie(\"strapiPreview\", process.env.GATSBY_PREVIEW_SECRET, {\n      path: \"/\",\n      secure: process.env.NODE_ENV,\n      sameSite: \"Strict\",\n    })\n  }\n\n  useEffect(() => {\n    const fetchData = async () => {\n      const [data] = await fetchAPI(`/pages?_locale=${locale}&slug=${slug}`)\n      setSecretPage(data)\n\n      const context = {\n        slug: data.slug,\n        id: data.id,\n        locale: data.locale,\n        localizations: data.localizations,\n        locales,\n        defaultLocale,\n        isPreview: true,\n      }\n\n      const localizedPaths = getLocalizedPaths(context)\n\n      setPageContext({ ...context, localizedPaths })\n    }\n\n    fetchData()\n  }, [slug, locales, defaultLocale, locale])\n\n  if (!pageContext || !strapiGlobal) {\n    return <div>loading preview...</div>\n  }\n\n  if (!cookies.strapiPreview) {\n    return (\n      <Layout pageContext={pageContext} global={strapiGlobal}>\n        <div className=\"mt-4 text-center\">\n          You need to turn preview mode on to view this page\n        </div>\n      </Layout>\n    )\n  }\n\n  return (\n    <>\n      <SEO seo={metaData} locale={pageContext.locale} global={strapiGlobal} />\n      <Layout pageContext={pageContext} global={strapiGlobal}>\n        {secretPage && (\n          <div>\n            <Sections sections={secretPage.contentSections} />\n          </div>\n        )}\n      </Layout>\n    </>\n  )\n}\n\nexport default PreviewPage\n\nexport const query = graphql`\n  query PreviewSiteQuery($locale: String!) {\n    site {\n      siteMetadata {\n        languages {\n          locales\n          defaultLocale\n        }\n      }\n    }\n    strapiGlobal(locale: { eq: $locale }) {\n      ...GlobalData\n    }\n  }\n`\n"],"sourceRoot":""}